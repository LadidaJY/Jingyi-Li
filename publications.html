<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jingyi Li | Publications</title>
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome 图标 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- 自定义样式 -->
    <link rel="stylesheet" href="css/style-publications.css">
</head>

<body>
    <!-- 头部区域 -->
    <header class="text-center py-4 mb-4">
        <div class="language-switcher position-absolute top-0 end-0 mt-3 me-3">
            <button class="lang-btn active" data-lang="en">EN</button>
            <button class="lang-btn" data-lang="zh">中文</button>
        </div>
        <h1 class="i18n" data-i18n="name">Jingyi Li</h1>
        <p class="subtitle i18n" data-i18n="title">Publications</p>
    </header>

    <!-- 导航栏 -->
    <nav class="navbar navbar-expand-lg bg-accent sticky-top rounded mb-3">
        <div class="container-fluid">
            <button class="navbar-toggler text-white" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <i class="fas fa-bars"></i>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <div class="navbar-nav w-100 justify-content-start">
                    <a href="index.html" class="nav-btn nav-link text-center">
                        <i class="fas fa-home"></i>
                        <span class="i18n d-block" data-i18n="home">Home</span>
                    </a>
                    <a href="CV.html" class="nav-btn nav-link text-center">
                        <i class="fas fa-file-alt"></i>
                        <span class="i18n d-block" data-i18n="cv">CV</span>
                    </a>
                    <a href="research.html" class="nav-btn nav-link text-center">
                        <i class="fas fa-computer"></i>
                        <span class="i18n d-block" data-i18n="research">Research</span>
                    </a>
                    <a href="publications.html" class="nav-btn nav-link text-center active">
                        <i class="fas fa-book"></i>
                        <span class="i18n d-block" data-i18n="publications">Publications</span>
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <div class="container">
        <!-- 出版物部分 -->
        <section class="publications-section bp-4 mb-5">
            <h2 class="i18n mb-3 pb-2 border-bottom" data-i18n="publications">Publications</h2>        
            <div class="filter-container mb-3 d-flex justify-content-between flex-wrap">
                <div class="year-filter d-flex align-items-center gap-2">
                    <span class="i18n" data-i18n="filter_year">Filter:</span>
                    <select id="yearFilter" class="form-select form-select-sm">
                        <option value="all" class="i18n" data-i18n="all_years">All Years</option>
                        <!-- Years will be populated dynamically -->
                    </select>
                </div>
            </div>
            
            <div class="publication-list" id="publicationList">
                <!-- Publications will be dynamically inserted here -->
                <div class="text-center py-4">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <p class="mt-2 i18n" data-i18n="loading">Loading publications...</p>
                </div>
            </div>
        </section>
    </div>

    <footer class="text-center py-3 mt-4 rounded bg-light border-top">
        <p class="i18n mb-0" data-i18n="footer">Jingyi Li | Ecology | 
            <a href="mailto:lijingyi1015@gmail.com" class="text-decoration-none">lijingyi1015@gmail.com</a>
        </p>
    </footer>

    <!-- Bootstrap JS Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // 多语言支持
        const translations = {
            en: {
                name: "Jingyi Li",
                title: "Publications",
                home: "Home",
                cv: "CV",
                research: "Research",
                publications: "Publications",
                filter_year: "Filter:",
                all_years: "All Years",
                doi_link: "DOI",
                loading: "Loading publications..."
            },
            zh: {
                name: "李菁祎",
                title: "出版物",
                home: "首页",
                cv: "个人简历",
                research: "研究",
                publications: "出版物",
                filter_year: "筛选:",
                all_years: "全部年份",
                doi_link: "DOI",
                loading: "正在加载出版物..."
            }
        };
        
        // 当前语言
        let currentLang = 'en';
        let allPublications = [];
        
        // 突出显示作者名字
        function highlightAuthor(authors) {
            // 根据当前语言突出显示名字
            if (currentLang === 'en') {
                return authors.replace(/Jingyi Li/g, '<strong>Jingyi Li</strong>');
            } else {
                return authors.replace(/李菁祎/g, '<strong>李菁祎</strong>');
            }
        }
        
        // 加载出版物数据
        function loadPublications() {
            // 从JSON文件加载出版物数据
            fetch('publications.json')
                .then(response => response.json())
                .then(data => {
                    allPublications = [...data];
                    processPublications(allPublications);
                })
                .catch(error => {
                    console.error('Error loading publications:', error);
                    const publicationList = document.getElementById('publicationList');
                    publicationList.innerHTML = `
                        <div class="alert alert-danger">
                            Error loading publications. Please try again later.
                        </div>
                    `;
                });
        }
        
        // 处理出版物数据
        function processPublications(publications) {
            // 1. 按年份倒序排序
            // 2. 同年份时优先显示第一作者或通讯作者的出版物
            publications.sort((a, b) => {
                // 首先按年份倒序
                if (b.year !== a.year) {
                    return b.year - a.year;
                }
                
                // 同年份时判断作者身份
                const aIsFirstOrLast = isFirstOrLastAuthor(a.authors);
                const bIsFirstOrLast = isFirstOrLastAuthor(b.authors);
                
                if (aIsFirstOrLast && !bIsFirstOrLast) return -1;
                if (!aIsFirstOrLast && bIsFirstOrLast) return 1;
                
                // 如果都是或都不是，保持原始顺序
                return 0;
            });
            
            // 渲染出版物列表
            renderPublications(publications);
            
            // 更新年份筛选器
            updateYearFilter(publications);
        }
        
        // 判断是否是第一作者或通讯作者
        function isFirstOrLastAuthor(authors) {
            // 假设第一作者是第一个名字，通讯作者是最后一个名字
            const authorList = authors.split(', ');
            
            // 检查是否是第一作者
            if (authorList[0].includes('Jingyi Li') || authorList[0].includes('李菁祎')) {
                return true;
            }
            
            // 检查是否是通讯作者
            if (authorList[authorList.length - 1].includes('Jingyi Li') || 
                authorList[authorList.length - 1].includes('李菁祎')) {
                return true;
            }
            
            return false;
        }
        
        // 渲染出版物列表
        function renderPublications(publications) {
            const publicationList = document.getElementById('publicationList');
            
            if (publications.length === 0) {
                publicationList.innerHTML = `
                    <div class="alert alert-info">
                        No publications found for the selected year.
                    </div>
                `;
                return;
            }
            
            publicationList.innerHTML = '';
            
            publications.forEach(pub => {
                // 突出显示作者名字
                const highlightedAuthors = highlightAuthor(pub.authors);
                
                const pubItem = document.createElement('div');
                pubItem.className = 'card mb-3 publication-item';
                
                pubItem.innerHTML = `
                    <div class="card-body position-relative">
                        <div class="publication-year position-absolute top-0 end-0 bg-primary text-white px-3 py-1 rounded-start">
                            ${pub.year}
                        </div>
                        <h3 class="card-title publication-title">${pub.title}</h3>
                        <div class="card-text publication-authors">${highlightedAuthors}</div>
                        <div class="publication-journal text-success fw-bold mt-2">${pub.journal}</div>
                        <div class="publication-links d-flex gap-2 mt-3">
                            ${pub.doi ? `
                            <a href="${pub.doi}" target="_blank" class="btn btn-sm btn-outline-primary">
                                <i class="fas fa-external-link-alt me-1"></i>
                                <span class="i18n" data-i18n="doi_link">DOI</span>
                            </a>` : ''}
                            ${pub.pdf ? `
                            <a href="${pub.pdf}" target="_blank" class="btn btn-sm btn-outline-danger">
                                <i class="fas fa-file-pdf me-1"></i>
                                <span class="i18n" data-i18n="pdf_link">PDF</span>
                            </a>` : ''}
                            ${pub.github ? `
                            <a href="${pub.github}" target="_blank" class="btn btn-sm btn-outline-dark">
                                <i class="fab fa-github me-1"></i>
                                <span class="i18n" data-i18n="github_link">Code</span>
                            </a>` : ''}
                        </div>
                    </div>
                `;
                
                publicationList.appendChild(pubItem);
            });
            
            // 更新语言
            updateLanguageElements();
        }
        
        // 更新年份筛选器选项
        function updateYearFilter(publications) {
            const yearFilter = document.getElementById('yearFilter');
            
            // 获取所有年份并去重
            const years = [...new Set(publications.map(pub => pub.year))];
            
            // 按年份倒序排序
            years.sort((a, b) => b - a);
            
            // 清空现有选项（保留"All Years"）
            while (yearFilter.options.length > 1) {
                yearFilter.remove(1);
            }
            
            // 添加年份选项
            years.forEach(year => {
                const option = document.createElement('option');
                option.value = year;
                option.textContent = year;
                yearFilter.appendChild(option);
            });
        }
        
        // 年份筛选功能
        function setupYearFilter() {
            const yearFilter = document.getElementById('yearFilter');
            yearFilter.addEventListener('change', () => {
                const year = yearFilter.value;
                
                if (year === 'all') {
                    // 显示所有出版物
                    renderPublications(allPublications);
                } else {
                    // 筛选特定年份的出版物
                    const filteredPubs = allPublications.filter(pub => pub.year == year);
                    renderPublications(filteredPubs);
                }
            });
        }
        
        // 更新语言元素
        function updateLanguageElements() {
            document.querySelectorAll('.i18n').forEach(element => {
                const key = element.getAttribute('data-i18n');
                if (translations[currentLang][key]) {
                    if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
                        element.value = translations[currentLang][key];
                    } else {
                        element.textContent = translations[currentLang][key];
                    }
                }
            });
        }

        // 语言切换功能
        document.querySelectorAll('.lang-btn').forEach(button => {
            button.addEventListener('click', function() {
                const lang = this.getAttribute('data-lang');
                currentLang = lang;
                
                // 更新按钮状态
                document.querySelectorAll('.lang-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                this.classList.add('active');
                
                // 更新页面内容
                updateLanguageElements();
                
                // 重新渲染出版物以更新作者高亮
                renderPublications(allPublications);
            });
        });

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            // 加载出版物数据
            loadPublications();
            
            // 设置年份筛选器
            setupYearFilter();
            
            // 初始设置英文为默认语言
            updateLanguageElements();
        });
    </script>
</body>
</html>